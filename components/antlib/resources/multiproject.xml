<?xml version="1.0" encoding="utf-8"?>
<project name="multiproject" default="usage" basedir=".">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
# 
# Copyright 2006 University of Dundee. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
# 
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore <josh.moore@gmx.de>
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  DOCUMENTATION:
  =================================================

	  The idea for these targets is taken from maven2 and is
	  supported by the ${import.dir}/lifecycle.xml ant script.
	  Unlike most other targets which can be called from anywhere,
	  these targets can only be called from the top-level because
	  they mask the lifecycle.xml target definitions.

-->

	<macrodef name="iterate">
		<attribute name="inheritAll" default="false"/>
		<attribute name="inheritRefs" default="false"/>
		<attribute name="buildpathref" default="deps.build.path"/>
		<attribute name="target"/>
		<sequential>
		<subant verbose="true" buildpathref="@{buildpathref}" inheritAll="@{inheritAll}" inheritRefs="@{inheritRefs}" failonerror="true" target="@{target}">
			<property name="multi.test.with.fail" value="${test.with.fail}"/>
			<property name="multi.test.skip" value="${test.skip}"/>
			<property name="multi.generate.skip" value="${generate.skip}"/>
			<property name="multi.checks.skip" value="${checks.skip}"/>
			<!-- Defaults set in dependencies.xml -->
			<property name="ivy.buildlist.ivyfilepath" value="${ivy.buildlist.ivyfilepath}"/>
			<property name="ivy.dep.file" value="${ivy.dep.file}"/>
		</subant>
		</sequential>
	</macrodef>

	<target name="multiproject" depends="deps-buildlist"/>

	<target name="multi" depends="multiproject"
		description="Convenience target. Iterates over all components calling the $${target} method (default=${defaultTarget}">
		<property name="target" value="install"/>
		<iterate target="${target}"/>
	</target>

	<target name="prepare" depends="multiproject"
		description="Lifecycle target: calls 'prepare' on all components">
		<iterate target="prepare"/>
	</target>

	<target name="generate" depends="multiproject"
		description="Lifecycle target: calls 'generate' on all components">
		<iterate target="generate"/>
	</target>

	<target name="compile" depends="multiproject"
		description="Lifecycle target: calls 'compile' on all components">
		<iterate target="compile"/>
	</target>

	<target name="test" depends="multiproject"
		description="Lifecycle target: calls 'test' on all components">
		<iterate target="test"/>
	</target>

	<target name="package" depends="multiproject"
		description="Lifecycle target: calls 'package' on all components">
		<iterate target="package"/>
	</target>

	<target name="install" depends="multiproject"
		description="Lifecycle target: calls 'install' on all components">
		<iterate target="install"/>
	</target>

	<target name="integration" depends="multiproject"
		description="Lifecycle target: calls 'integration' on all components">
		<iterate target="integration"/>
	</target>

</project>
